version: "3.9"
services:
  cdxgen:
    image: ghcr.io/appthreat/cdxgen
    ports:
      - "9090:9090"
    volumes:
      - /tmp:/tmp
    command: cdxgen --server --server-host 0.0.0.0 --server-port 9090

  depscan:
    image: ghcr.io/appthreat/dep-scan
    ports:
      - "7070:7070"
    volumes:
      - /tmp:/tmp
    entrypoint: depscan --server --server-host 0.0.0.0 --server-port 7070 --cdxgen-server http://cdxgen:9090
    environment:
      VDB_HOME: /tmp/vdb

  cpggen:
    image: ghcr.io/appthreat/cpggen:main
    ports:
      - "7072:7072"
    volumes:
      - /tmp:/tmp
    mem_limit: 128000m
    mem_reservation: 64000m
    command: cpggen --server --server-host 0.0.0.0 --server-port 7072

  joern:
    image: ghcr.io/joernio/joern:master
    ports:
      - "9000:9000"
    volumes:
      - /tmp:/tmp
    cpus: 2
    mem_limit: 8000m
    mem_reservation: 4000m
    command: joern -J-Xmx4g --server --server-host 0.0.0.0 --server-port 9000 --server-auth-username admin --server-auth-password admin

  polynote:
    image: ghcr.io/appthreat/polynote
    volumes:
      - ./contrib/polynote/notebooks:/opt/notebooks
      - ./contrib/polynote/config.yml:/opt/config/config.yml
      - /tmp:/tmp
      - ./:/opt/joern_lib
    ports:
      - "8192:8192"
    command: --config /opt/config/config.yml
